
---DATA CLEANING PROJECT

----------------------------------------------------------------------

--1. Exploring the data set

Select *
From dbo.NHD

-------------------------------------------------------------------------
--2. From the data set, we can see that the datetime format is inconsistent. 

---To standardize the sale date and sale time.

Select saleDateConverted, CONVERT (Date,saleDate) AS New_date, (Right(saleDate, 8)) as SaleTime
From dbo.NHD


---Creating a saleTime column

ALTER TABLE dbo.NHD
Add SaleTime TIME;

---Updating the new column with the new time

Update dbo.NHD
Set SaleTime = CONVERT (Time,(Right(saleDate, 8)))
From dbo.NHD;

---Updating the table with the new date

Update dbo.NHD
SET SaleDate = CONVERT(Date,SaleDate)

-- Alternatively, if the query doesnt update

ALTER TABLE dbo.NHD
Add SaleDateConverted Date;

Update dbo.NHD
SET SaleDateConverted = CONVERT(Date,SaleDate)

--------------------------------------------------------------------------------------

--3. Populate the property address data
---Exploring the null values in the data table

Select *
From dbo.NHD
Where PropertyAddress is null
order by ParcelID

---To update the property address data table, carryout a self join of the table with respect to the ParcelID and PropertyAddress column

Select a.ParcelID, a.PropertyAddress, b.ParcelID, b.PropertyAddress, ISNULL(a.PropertyAddress,b.PropertyAddress)
From dbo.NHD a
JOIN dbo.NHD b
	on a.ParcelID = b.ParcelID
AND a.[UniqueID ] <> b.[UniqueID ]
Where a.PropertyAddress is null

---To Update Table A

Update a
SET PropertyAddress = ISNULL(a.PropertyAddress,b.PropertyAddress)
From dbo.NHD a
JOIN dbo.NHD b
	on a.ParcelID = b.ParcelID
AND a.[UniqueID ] <> b.[UniqueID ]
Where a.PropertyAddress is null

-----------------------------------------------------------------------------------------------
--4. Seperating the Propertyaddress into individual columns such as address and city

Select PropertyAddress
From dbo.NHD

SELECT
PropertyAddress, SUBSTRING(PropertyAddress, 1, CHARINDEX(',', PropertyAddress) -1) as Address, 
SUBSTRING(PropertyAddress, CHARINDEX(',', PropertyAddress) + 1, LEN(PropertyAddress)) as Address
From dbo.NHD

-----------------------------------------------------------------------------------------------
--Creating two new columns for property-address and property-city

ALTER TABLE Dbo.NHD
Add PropertySplitAddress Nvarchar(255);

Update Dbo.NHD
SET PropertySplitAddress = SUBSTRING(PropertyAddress, 1, CHARINDEX(',', PropertyAddress) -1 )


ALTER TABLE Dbo.NHD
Add PropertySplitCity Nvarchar(255);

Update Dbo.NHD
SET PropertySplitCity = SUBSTRING(PropertyAddress, CHARINDEX(',', PropertyAddress) + 1 , LEN(PropertyAddress))

---------------------------------------------------------------------------------------------------------------

---5. Seperating the Owneraddress into individual columns such as address, city, State

---Exploring the owner Address column

Select OwnerAddress
From dbo.NHD

Select
PARSENAME(REPLACE(OwnerAddress, ',', '.') , 3) ,PARSENAME(REPLACE(OwnerAddress, ',', '.') , 2) ,PARSENAME(REPLACE(OwnerAddress, ',', '.') , 1)
From dbo.NHD

---Updating the NHD table with the new-ownerSplitAddress Column

ALTER TABLE Dbo.NHD
Add OwnerSplitAddress Nvarchar(255);

Update Dbo.NHD
SET OwnerSplitAddress = PARSENAME(REPLACE(OwnerAddress, ',', '.') , 3)


---Updating the NHD table with the new-ownerSplitCity Column

ALTER TABLE dbo.NHD
Add OwnerSplitCity Nvarchar(255);

Update dbo.NHD
SET OwnerSplitCity = PARSENAME(REPLACE(OwnerAddress, ',', '.') , 2)


---Updating the NHD table with the new-ownerSplitState Column

ALTER TABLE dbo.NHD
Add OwnerSplitState Nvarchar(255);

Update dbo.NHD
SET OwnerSplitstate = PARSENAME(REPLACE(OwnerAddress, ',', '.') , 1)



---5. Making the "Sold as Vacant" field consistent 

---Exploring the "Sold as Vacant" field

Select Distinct(SoldAsVacant), Count(SoldAsVacant)
From dbo.NHD
Group by SoldAsVacant

Select SoldAsVacant
, CASE When SoldAsVacant = 'Y' THEN 'Yes'
	   When SoldAsVacant = 'N' THEN 'No'
	   ELSE SoldAsVacant
	   END
From dbo.NHD

-----updating the "Sold as Vacant" column

Update dbo.NHD
SET SoldAsVacant = CASE When SoldAsVacant = 'Y' THEN 'Yes'
	   When SoldAsVacant = 'N' THEN 'No'
	   ELSE SoldAsVacant
	   END

---6. Removing duplicate values

WITH RowNumCTE AS(
Select *,
	ROW_NUMBER() OVER (                          
	PARTITION BY ParcelID,
				 PropertyAddress,
				 SalePrice,
				 SaleDate,
				 LegalReference
				 ORDER BY
					UniqueID
					) row_num

From dbo.NHD

)
Select *
From RowNumCTE
Where row_num > 1
Order by PropertyAddress










































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































